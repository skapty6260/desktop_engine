#ifndef SHM_H
#define SHM_H

#include <stdint.h>
#include <wayland-server.h>

struct shm_pool {
    struct wl_resource *resource;
    struct wl_list link;
    int fd;                 
    size_t size;            
    void *data;             
    struct wl_list buffers;
};

void bind_shm(struct wl_client *client, void *data, uint32_t version, uint32_t id);

#ifdef _WIN32
/**
 * Wayland SHM pixel formats
 * Based on Wayland protocol specification
 */
enum wl_shm_format {
    /* 32-bit RGB/ARGB formats */
    WL_SHM_FORMAT_ARGB8888 = 0,
    WL_SHM_FORMAT_XRGB8888 = 1,
    
    /* 8-bit color formats */
    WL_SHM_FORMAT_C8 = 0x20203843,
    WL_SHM_FORMAT_RGB332 = 0x38424752,
    WL_SHM_FORMAT_BGR233 = 0x38524742,
    
    /* 16-bit RGB/ARGB formats */
    WL_SHM_FORMAT_XRGB4444 = 0x32315258,
    WL_SHM_FORMAT_XBGR4444 = 0x32314258,
    WL_SHM_FORMAT_RGBX4444 = 0x32315852,
    WL_SHM_FORMAT_BGRX4444 = 0x32315842,
    WL_SHM_FORMAT_ARGB4444 = 0x32315241,
    WL_SHM_FORMAT_ABGR4444 = 0x32314241,
    WL_SHM_FORMAT_RGBA4444 = 0x32314152,
    WL_SHM_FORMAT_BGRA4444 = 0x32314142,
    WL_SHM_FORMAT_XRGB1555 = 0x35315258,
    WL_SHM_FORMAT_XBGR1555 = 0x35314258,
    WL_SHM_FORMAT_RGBX5551 = 0x35315852,
    WL_SHM_FORMAT_BGRX5551 = 0x35315842,
    WL_SHM_FORMAT_ARGB1555 = 0x35315241,
    WL_SHM_FORMAT_ABGR1555 = 0x35314241,
    WL_SHM_FORMAT_RGBA5551 = 0x35314152,
    WL_SHM_FORMAT_BGRA5551 = 0x35314142,
    WL_SHM_FORMAT_RGB565 = 0x36314752,
    WL_SHM_FORMAT_BGR565 = 0x36314742,
    
    /* 24-bit RGB formats */
    WL_SHM_FORMAT_RGB888 = 0x34324752,
    WL_SHM_FORMAT_BGR888 = 0x34324742,
    
    /* 32-bit packed formats */
    WL_SHM_FORMAT_XBGR8888 = 0x34324258,
    WL_SHM_FORMAT_RGBX8888 = 0x34325852,
    WL_SHM_FORMAT_BGRX8888 = 0x34325842,
    WL_SHM_FORMAT_ABGR8888 = 0x34324241,
    WL_SHM_FORMAT_RGBA8888 = 0x34324152,
    WL_SHM_FORMAT_BGRA8888 = 0x34324142,
    
    /* 30/32-bit high depth formats */
    WL_SHM_FORMAT_XRGB2101010 = 0x30335258,
    WL_SHM_FORMAT_XBGR2101010 = 0x30334258,
    WL_SHM_FORMAT_RGBX1010102 = 0x30335852,
    WL_SHM_FORMAT_BGRX1010102 = 0x30335842,
    WL_SHM_FORMAT_ARGB2101010 = 0x30335241,
    WL_SHM_FORMAT_ABGR2101010 = 0x30334241,
    WL_SHM_FORMAT_RGBA1010102 = 0x30334152,
    WL_SHM_FORMAT_BGRA1010102 = 0x30334142,
    
    /* YCbCr packed formats */
    WL_SHM_FORMAT_YUYV = 0x56595559,
    WL_SHM_FORMAT_YVYU = 0x55595659,
    WL_SHM_FORMAT_UYVY = 0x59565955,
    WL_SHM_FORMAT_VYUY = 0x59555956,
    WL_SHM_FORMAT_AYUV = 0x56555941,
    
    /* YCbCr semi-planar formats */
    WL_SHM_FORMAT_NV12 = 0x3231564e,
    WL_SHM_FORMAT_NV21 = 0x3132564e,
    WL_SHM_FORMAT_NV16 = 0x3631564e,
    WL_SHM_FORMAT_NV61 = 0x3136564e,
    
    /* YCbCr planar formats */
    WL_SHM_FORMAT_YUV410 = 0x39565559,
    WL_SHM_FORMAT_YVU410 = 0x39555659,
    WL_SHM_FORMAT_YUV411 = 0x31315559,
    WL_SHM_FORMAT_YVU411 = 0x31315659,
    WL_SHM_FORMAT_YUV420 = 0x32315559,
    WL_SHM_FORMAT_YVU420 = 0x32315659,
    WL_SHM_FORMAT_YUV422 = 0x36315559,
    WL_SHM_FORMAT_YVU422 = 0x36315659,
    WL_SHM_FORMAT_YUV444 = 0x34325559,
    WL_SHM_FORMAT_YVU444 = 0x34325659,
    
    /* Luminance/Chrominance formats */
    WL_SHM_FORMAT_R8 = 0x20203852,
    WL_SHM_FORMAT_R16 = 0x20363152,
    WL_SHM_FORMAT_RG88 = 0x38384752,
    WL_SHM_FORMAT_GR88 = 0x38385247,
    WL_SHM_FORMAT_RG1616 = 0x32334752,
    WL_SHM_FORMAT_GR1616 = 0x32335247,
    
    /* 64-bit float formats */
    WL_SHM_FORMAT_XRGB16161616F = 0x48345258,
    WL_SHM_FORMAT_XBGR16161616F = 0x48344258,
    WL_SHM_FORMAT_ARGB16161616F = 0x48345241,
    WL_SHM_FORMAT_ABGR16161616F = 0x48344241,
    
    /* Additional YCbCr formats */
    WL_SHM_FORMAT_XYUV8888 = 0x56555958,
    WL_SHM_FORMAT_VUY888 = 0x34325556,
    WL_SHM_FORMAT_VUY101010 = 0x30335556,
    WL_SHM_FORMAT_Y210 = 0x30313259,
    WL_SHM_FORMAT_Y212 = 0x32313259,
    WL_SHM_FORMAT_Y216 = 0x36313259,
    WL_SHM_FORMAT_Y410 = 0x30313459,
    WL_SHM_FORMAT_Y412 = 0x32313459,
    WL_SHM_FORMAT_Y416 = 0x36313459,
    WL_SHM_FORMAT_XVYU2101010 = 0x30335658,
    WL_SHM_FORMAT_XVYU12_16161616 = 0x36335658,
    WL_SHM_FORMAT_XVYU16161616 = 0x38345658,
    
    /* Complex YCbCr formats */
    WL_SHM_FORMAT_Y0L0 = 0x304c3059,
    WL_SHM_FORMAT_X0L0 = 0x304c3058,
    WL_SHM_FORMAT_Y0L2 = 0x324c3059,
    WL_SHM_FORMAT_X0L2 = 0x324c3058,
    
    /* Additional video formats */
    WL_SHM_FORMAT_YUV420_8BIT = 0x38305559,
    WL_SHM_FORMAT_YUV420_10BIT = 0x30315559,
    
    /* Alpha channel variants */
    WL_SHM_FORMAT_XRGB8888_A8 = 0x38415258,
    WL_SHM_FORMAT_XBGR8888_A8 = 0x38414258,
    WL_SHM_FORMAT_RGBX8888_A8 = 0x38415852,
    WL_SHM_FORMAT_BGRX8888_A8 = 0x38415842,
    WL_SHM_FORMAT_RGB888_A8 = 0x38413852,
    WL_SHM_FORMAT_BGR888_A8 = 0x38413842,
    WL_SHM_FORMAT_RGB565_A8 = 0x38413552,
    WL_SHM_FORMAT_BGR565_A8 = 0x38413542,
    
    /* Extended YCbCr formats */
    WL_SHM_FORMAT_NV24 = 0x3432564e,
    WL_SHM_FORMAT_NV42 = 0x3234564e,
    WL_SHM_FORMAT_P210 = 0x30313250,
    WL_SHM_FORMAT_P010 = 0x30313050,
    WL_SHM_FORMAT_P012 = 0x32313050,
    WL_SHM_FORMAT_P016 = 0x36313050,
    
    /* Special formats */
    WL_SHM_FORMAT_AXBXGXRX106106106106 = 0x30314241,
    WL_SHM_FORMAT_NV15 = 0x3531564e,
    WL_SHM_FORMAT_Q410 = 0x30313451,
    WL_SHM_FORMAT_Q401 = 0x31303451,
    
    /* 64-bit integer formats */
    WL_SHM_FORMAT_XRGB16161616 = 0x38345258,
    WL_SHM_FORMAT_XBGR16161616 = 0x38344258,
    WL_SHM_FORMAT_ARGB16161616 = 0x38345241,
    WL_SHM_FORMAT_ABGR16161616 = 0x38344241,
    
    /* Indexed color formats */
    WL_SHM_FORMAT_C1 = 0x20203143,
    WL_SHM_FORMAT_C2 = 0x20203243,
    WL_SHM_FORMAT_C4 = 0x20203443,
    WL_SHM_FORMAT_D1 = 0x20203144,
    WL_SHM_FORMAT_D2 = 0x20203244,
    WL_SHM_FORMAT_D4 = 0x20203444,
    WL_SHM_FORMAT_D8 = 0x20203844,
    
    /* Additional luminance formats */
    WL_SHM_FORMAT_R1 = 0x20203152,
    WL_SHM_FORMAT_R2 = 0x20203252,
    WL_SHM_FORMAT_R4 = 0x20203452,
    WL_SHM_FORMAT_R10 = 0x20303152,
    WL_SHM_FORMAT_R12 = 0x20323152,
    
    /* Additional packed YCbCr formats */
    WL_SHM_FORMAT_AVUY8888 = 0x59555641,
    WL_SHM_FORMAT_XVUY8888 = 0x59555658,
    
    /* Final video format */
    WL_SHM_FORMAT_P030 = 0x30333050
};
#endif

#endif